# Ender-Bender-Firmware
Custom Marlin firmware configurations for Creality Ender 3 with CR Touch auto bed leveling

## Documentation
- [Flashing Instructions](flashing-instructions.md)
- [Managing Configurations](managing-configurations.md)

## Initial Setup

1. Clone the repositories:
```bash
# Create base directory
mkdir ~/3d_printing
cd ~/3d_printing

# Clone Marlin
git clone -b bugfix-2.1.x https://github.com/MarlinFirmware/Marlin.git Marlin-2.1.x

# Clone configurations
git clone https://github.com/yourusername/ender-bender-firmware.git
```

2. Link configurations:
```bash
# Create symbolic link to configurations
cd Marlin-2.1.x/Marlin
ln -s ../../ender-bender-firmware/configs config

# Verify the link
ls -la config
```

## Project Structure
```
ðŸ“ My-Project-Directory (~/3d_printing)
â”œâ”€â”€ ðŸ“ Marlin-2.1.x (cloned from MarlinFirmware/Marlin)
â”‚   â”œâ”€â”€ ðŸ“ Marlin
â”‚   â”‚   â”œâ”€â”€ ðŸ“ config -> ../../ender-bender-firmware/configs  # Symbolic link
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ Configuration.h      # Comes with Marlin
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ Configuration_adv.h  # Comes with Marlin
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ Configuration_override.h  # Generated during build
â”‚   â”‚   â””â”€â”€ ðŸ“„ Marlin.ino          # Comes with Marlin
â”‚   â”œâ”€â”€ ðŸ“„ platformio.ini          # Comes with Marlin, we modify
â”‚   â””â”€â”€ ðŸ“„ README.md               # Marlin's documentation
â”‚
â””â”€â”€ ðŸ“ ender-bender-firmware (my config repository)
    â”œâ”€â”€ ðŸ“ configs
    â”‚   â””â”€â”€ ðŸ“ ender3
    â”‚       â”œâ”€â”€ ðŸ“„ ender3-crtouch.ini  # CR Touch config
    â”‚       â””â”€â”€ ðŸ“„ ender3-stock.ini    # Stock config
    â”œâ”€â”€ ðŸ“„ README.md                   # This documentation
    â”œâ”€â”€ ðŸ“„ flashing-instructions.md    # How to flash firmware
    â””â”€â”€ ðŸ“„ managing-configurations.md  # Configuration management guide
```

### File Origins
- **From Marlin Repository:**
  - `Configuration.h` - Base configuration file
  - `Configuration_adv.h` - Advanced configuration file
  - `Marlin.ino` - Main Marlin sketch
  - `platformio.ini` - Build configuration (we modify this)

- **Generated During Build:**
  - `Configuration_override.h` - Created from your INI file

- **From Your Repository:**
  - All files in `ender-bender-firmware`
  - INI configuration files
  - Documentation

## VSCode Setup
1. Open VSCode
2. File -> Open Folder
3. Select the `Marlin-2.1.x` directory

## Configuration Management
- Keep configurations in the `config` subdirectory
- The path in `platformio.ini` is relative to the Marlin directory

### Update platformio.ini
Add the following to  `platformio.ini`:
```ini
[platformio]
default_envs = STM32F103RET6_creality

[env:STM32F103RET6_creality]
platform = ststm32
board = genericSTM32F103RE
framework = arduino
build_flags =
    -DCONFIG_FILE=ender3/ender3-crtouch.ini
    -DUSE_CONFIG_OVERRIDE
board_build.offset = 0x8000
```

#### Create Configuration Override
Create a new file `Configuration_override.h`:
```cpp
#pragma once

// This file is automatically generated from the INI config
// Do not edit this file directly

#include "config.h"
```